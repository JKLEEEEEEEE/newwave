# 🚀 기업 리스크 조기경보 시스템 (Risk Warning System) v14.1 구현 현황

## 1. 시스템 개요
본 시스템은 **14개 리스크 카테고리**와 **6대 핵심 정보 채널**을 통합 분석하여, 기업의 잠재적 리스크를 실시간으로 탐지, 전파 경로를 추적, AI 기반의 대응 전략을 제시하는 고도화된 모니터링 플랫폼입니다.

---

## 2. 핵심 구현 스펙 (Core Specs)

### 📊 14대 리스크 카테고리 (Broad Coverage)
기존 재무/공시 중심에서 비재무/정성적 영역까지 확장하여 사각지대 없는 모니터링을 수행합니다.
1.  **공시 (Disclosure)**: 정정공시, 관리종목 지정 등
2.  **뉴스 (News)**: 횡령, 배임, 압수수색 등
3.  **주주 (Shareholder)**: 경영권 분쟁, 최대주주 변경
4.  **임원 (Executive)**: 임원 사임/해임, 낙하산 논란
5.  **특허 (Patent)**: 특허 침해 소송, 무효 심판 **(High Weight)**
6.  **채용/평판 (HR/Review)**: 잡플래닛/블라인드 부정 리뷰, 퇴사율 급증
7.  **소송 (Legal)**: 손해배상, 가처분 신청
8.  **신용등급 (Credit Rating)**: 등급 하락, 부정적 전망
9.  **금감원 (FSS)**: 제재, 과징금, 경고
10. **ESG**: 환경 오염, 노사 갈등, 지배구조 이슈
11. **SNS/커뮤니티**: 소비자 불매 운동, 부정적 여론
12. **부동산 (Real Estate)**: PF 부실, 자산 가압류
13. **상표 (Trademark)**: 상표권 분쟁
14. **경쟁사 (Competitor)**: 경쟁 심화, 시장 점유율 하락

### 📡 6대 핵심 정보 채널 (Multi-Channel Scanning)
다양한 소스에서 데이터를 수집하여 교차 검증(Cross-Validation)을 수행합니다.
1.  **DART**: 금융감독원 전자공시시스템 (정형 데이터)
2.  **KIPRIS**: 특허청 특허 정보 (지식재산권 리스크)
3.  **대법원 (Scourt)**: 나의 사건 검색 (법적 분쟁)
4.  **NICE/신용평가사**: 기업 신용 및 재무 정보
5.  **잡플래닛/블라인드**: 재직자/퇴직자 리뷰 (내부 고발 성격)
6.  **뉴스/SNS**: 구글 뉴스, 네이버 뉴스, 포털 커뮤니티 (실시간 여론)

---

## 3. 주요 기능 및 고도화 (Advanced Features)

### 🕸️ 인터랙티브 리스크 관계도 (Interactive Entity Graph)
*   **Live Connection**: `print_entity_graph`에서 실제 Neo4j 그래프 DB의 노드/엣지(Node/Edge) 수를 실시간으로 집계하여 표시 (`● LIVE: 12 Nodes / 15 Edges`).
*   **Supply Chain Visualization**: 주요 **공급망(Supplier)** 관계를 시각화하여, 협력사의 리스크가 타겟 기업에 미치는 영향을 파악 가능.
*   **Risk Propagation**: 관계사 및 공급망의 리스크가 전이되는 과정을 수치화 (`직접 리스크 + 전이 리스크` 분리 표시).

### 🤖 AI Agent v2.0 (Industry-Specific)
*   **Action Guide v2.0**: 기업의 산업(예: 반도체, 바이오)을 자동 감지하여, 해당 산업 특성에 맞는 **RM(영업) / OPS(심사)** 대응 가이드를 생성.
    *   *예: "반도체 산업 특성상 특허 분쟁은 생산 중단으로 이어질 수 있으므로..."*
*   **Predictive Forecast**: 뉴스 및 이벤트를 분석하여 향후 1개월 간의 리스크 추세(Best/Base/Worst 시나리오)를 예측.

### ⏱️ 3단계 조기경보 타임라인 (3-Stage Warning)
리스크의 진행 단계를 3단계로 구분하여 선제적 대응을 유도합니다.
1.  **뉴스 보도 (Detection)**: 최초 징후 포착
2.  **금융위 통지 (Regulation)**: 규제 기관의 개입 또는 공식화
3.  **대주단 확인 (Action)**: 실질적 금융 피해 또는 대응 필요 단계

---

## 4. 모니터링 대시보드 (`log.py`)
*   **통합 뷰**: 위 모든 정보를 터미널 환경에서도 직관적으로 확인할 수 있도록 UI/UX 최적화.
*   **증거 기반 (Evidence)**: "내부 규정 분석"과 "외부 뉴스"를 매핑하여 리스크 판단의 근거 제공.
*   **실시간성**: DB 조회 시점의 최신 데이터를 반영.

## 5. 향후 계획 (Next Steps)
*   **Dashboard UI**: Streamlit/React 기반의 웹 대시보드 구축 (현재는 `log.py` 터미널 뷰).
*   **Data Pipeline**: 실시간 크롤링 스케줄러 안정화.

---

## 6. 추가 도구 (Standalone Tools)
시스템의 유연성을 위해 별도 실행 가능한 모듈을 제공합니다.

### 🕵️ 상시 모니터링 에이전트 (Autonomous Agent)
*   **파일**: `monitoring_agent.py`
*   **기능**: 백그라운드에서 24/7 실행되며 신규 리스크 신호를 실시간으로 감지하고 알림(SMS/Email Mock)을 발송합니다.
*   **실행**: `python monitoring_agent.py`

### 🗣️ Text2Cypher (자연어 질의)
*   **파일**: `query.py`
*   **기능**: 자연어 질문(예: *"리스크 점수가 가장 높은 기업은?"*)을 입력하면 자동으로 **Cypher Query**로 변환하여 DB에서 답을 찾아줍니다.
*   **실행**: `python query.py -i` (대화형 모드)

---

## 7. 코드베이스 구조 및 로직 상세 (Codebase Breakdown)

프로젝트의 모든 Python 파일(`*.py`)을 정밀 감사(Audit)한 결과입니다.

| 파일명 | 역할 및 핵심 로직 | 연동 및 데이터 흐름 |
| :--- | :--- | :--- |
| **`risk_engine.py`** | **핵심 엔진 & 스캐너** | • **14개 스캐너** 통합 (`DartAPI`, `NewsScanner`, `PatentScanner` 등)<br>• **리더보드/타임라인** 생성 (`RiskLeaderboard`, `TimelineGenerator`)<br>• Neo4j 데이터 적재 및 조회 담당 |
| **`log.py`** | **모니터링 뷰어 (UI)** | • **UI 렌더링**: 터미널에 대시보드 출력 (배너, 그래프, 타임라인)<br>• **실시간 데이터**: `system.graph`를 통해 Neo4j 라이브 데이터 조회<br>• **AI 연동**: `ai_service` 호출하여 가이드/예측 표시 |
| **`ai_service.py`** | **AI 인텔리전스** | • **OpenAI 연동**: GPT-4.1 mini 모델 사용<br>• **V2.0 가이드**: 산업(`industry`) 자동 감지 및 맞춤형 가이드 생성<br>• **Text2Cypher**: 자연어를 Cypher 쿼리로 변환 (`text2cypher` 함수) |
| **`run.py`** | **배치 실행기** | • **데이터 생성**: 기업 목록(`COMPANIES`) 순회하며 분석 실행<br>• **초기화**: `reset_data=True` 시 기존 DB 초기화 후 재구축<br>• **공급망 구축**: 초기 실행 시 `_init_supply_chain` 트리거 |
| **`monitoring_agent.py`** | **상시 감시 에이전트** | • **무한 루프**: 백그라운드에서 주기적(Sleep)으로 신호 감지<br>• **알림 발송**: Critical 신호 발생 시 SMS/Email 전송 (Mock) |
| **`query.py`** | **자연어 질의 CLI** | • **인터페이스**: `text2cypher` 기능을 CLI로 제공<br>• **대화형 모드**: `python query.py -i` 로 챗봇처럼 사용 가능 |
| **`init.py`** | **DB 초기화 유틸** | • **스키마 관리**: `.env.local` 로드 및 Neo4j 연결 테스트<br>• **Reset**: DB 전체 초기화(`DETACH DELETE`) 기능 제공 |
| **`test_integration.py`** | **통합 테스트** | • **기능 검증**: 공급망 데이터 유무, 뉴스 주입, AI 가이드 생성 여부 등<br>• **CI/CD**: 시스템 변경 시 핵심 로직 정상 작동 확인용 |

## 8. 데이터 무결성 검증 (Data Integrity)
*   **공급망 데이터**: `run.py` 실행 시 `RiskWarningSystem` 초기화 과정에서 `_init_supply_chain`이 호출되어 `SK하이닉스`와 `한미반도체` 등의 관계가 **자동 주입**됩니다.
*   **전이 리스크**: `RiskEngine` 내 `recalc_propagation` 로직이 존재하며, 관계사의 리스크를 전이(`Propagation Logic`)시켜 총점에 반영합니다.
*   **AI Fallback**: API 장애 시에도 룰 기반(`_fallback_guide`) 로직이 작동하여 시스템 중단을 방지합니다.
