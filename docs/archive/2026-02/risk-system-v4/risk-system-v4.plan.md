# Risk System V4 - 전면 재설계

> **Version**: 4.0
> **Created**: 2026-02-06
> **Status**: Planning
> **Priority**: Critical

---

## 1. 배경 및 문제점

### 1.1 현재 상황 분석

| 구분 | 설계서 | 실제 구현 | 갭 |
|------|--------|----------|-----|
| RiskCategory 노드 | 8개 카테고리 | **0개** | 100% 누락 |
| RiskEvent 노드 | 이슈/이벤트 관리 | **0개** | 100% 누락 |
| Person → News 관계 | 임원별 뉴스 연결 | **0개** | 100% 누락 |
| 리스크 점수 계산 | 키워드 + 카테고리 가중 | 단순 합산 | 불완전 |
| UI/UX | 현대적 대시보드 | 기본 테이블 | 개선 필요 |

### 1.2 핵심 문제

1. **데이터 연결 부재**
   - 기업 → 임원 ✅ (EXECUTIVE_OF 6개)
   - 기업 → 주주 ✅ (SHAREHOLDER_OF 19개)
   - **임원 → 관련 뉴스 ❌ (0개)**
   - **주주 → 관련 뉴스 ❌ (0개)**
   - **이슈/이벤트 노드 ❌ (0개)**

2. **리스크 분석 불가**
   - 현업이 "이 임원이 왜 위험한가?" 판단 불가
   - 근거 데이터(뉴스, 공시)와 엔티티 연결 없음
   - 카테고리별 breakdown 없음

3. **UI/UX 품질**
   - 피그마 수준 디자인 미달
   - 현업 즉시 이해 가능한 수준 아님
   - 드릴다운 네비게이션 부재

---

## 2. 목표

### 2.1 비전
> "현업이 보자마자 유용하고 이해 가능한 리스크 모니터링 시스템"

### 2.2 핵심 목표

| # | 목표 | 측정 기준 |
|---|------|----------|
| 1 | **완전한 데이터 연결** | 모든 엔티티에 관련 뉴스/이슈 연결 |
| 2 | **드릴다운 분석** | 기업 → 카테고리 → 엔티티 → 이슈 탐색 가능 |
| 3 | **투명한 점수** | 점수의 근거를 즉시 확인 가능 |
| 4 | **현대적 UI/UX** | Figma 수준, 직관적 네비게이션 |
| 5 | **백엔드 검증** | API 응답과 UI 일치 보장 |

---

## 3. 범위

### 3.1 In Scope

#### Phase 1: 데이터 구조 완성 (백엔드)
- [ ] RiskEvent 노드 설계 및 구현
- [ ] Person ↔ News 관계 구현
- [ ] RiskCategory 노드 생성 로직
- [ ] 점수 계산 파이프라인 연결

#### Phase 2: API 재설계
- [ ] 드릴다운 API: `/api/v4/deals/{id}/executives`
- [ ] 엔티티별 이슈 API: `/api/v4/persons/{id}/issues`
- [ ] 카테고리별 breakdown API
- [ ] 점수 근거(evidence) API

#### Phase 3: UI/UX 전면 개편
- [ ] 모던 디자인 시스템 적용
- [ ] 드릴다운 네비게이션
- [ ] 인터랙티브 차트/그래프
- [ ] 실시간 알림 UI

#### Phase 4: 검증 및 테스트
- [ ] API ↔ UI 데이터 일치 검증
- [ ] E2E 테스트 시나리오
- [ ] 현업 사용성 테스트

### 3.2 Out of Scope
- 모바일 앱
- 실시간 스트리밍 (WebSocket)
- 외부 시스템 연동

---

## 4. 핵심 설계 방향

### 4.1 그래프 구조 (To-Be)

```
                          ┌─────────────┐
                          │   Company   │
                          │ SK하이닉스   │
                          └──────┬──────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ RiskCategory    │    │ RiskCategory    │    │ RiskCategory    │
│ LEGAL (법률)    │    │ GOVERNANCE      │    │ CREDIT (신용)   │
│ Score: 25       │    │ (지배구조)       │    │ Score: 0        │
└────────┬────────┘    │ Score: 15       │    └─────────────────┘
         │             └────────┬────────┘
         │                      │
         ▼                      ▼
┌─────────────────┐    ┌─────────────────┐
│    RiskEvent    │    │     Person      │
│ "ITC 특허소송"   │    │ 홍길동 (대표이사)│
│ Score: 25       │    │ RiskScore: 15   │
└────────┬────────┘    └────────┬────────┘
         │                      │
         ▼                      ▼
┌─────────────────┐    ┌─────────────────┐
│      News       │    │      News       │
│ "특허 소송 제기" │    │ "횡령 혐의 보도" │
│ rawScore: 25    │    │ rawScore: 50    │
└─────────────────┘    └─────────────────┘
```

### 4.2 드릴다운 네비게이션

```
┌─────────────────────────────────────────────────────────┐
│ SK하이닉스 리스크 대시보드                    Score: 40 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📊 카테고리별 리스크                                    │
│  ┌─────────┬─────────┬─────────┬─────────┐             │
│  │ 법률 25 │ 지배 15 │ 신용 0  │ ESG 0   │ ← 클릭     │
│  └────┬────┴─────────┴─────────┴─────────┘             │
│       │                                                 │
│       ▼ [드릴다운]                                      │
│  ┌─────────────────────────────────────────┐           │
│  │ 법률 리스크 상세                         │           │
│  │                                         │           │
│  │ 📌 관련 이슈                             │           │
│  │ • ITC 특허소송 (Score: 25) ← 클릭       │           │
│  │   └─ 관련 뉴스 3건, 공시 1건             │           │
│  │                                         │           │
│  │ 👤 관련 임원                             │           │
│  │ • 홍길동 대표이사 ← 클릭                 │           │
│  │   └─ 관련 뉴스 2건                       │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.3 UI/UX 디자인 원칙

1. **정보 계층 명확화**: 중요도순 정렬, 시각적 강조
2. **원클릭 드릴다운**: 모든 요소 클릭 시 상세 정보
3. **증거 기반 표시**: 점수 옆에 항상 근거 링크
4. **색상 시스템**: PASS(초록), WARNING(노랑), FAIL(빨강)
5. **반응형**: 모바일/데스크톱 대응

---

## 5. 기술 스택

| 구분 | 현재 | 변경 |
|------|------|------|
| **Frontend** | React + Vite | React + Vite + **shadcn/ui** |
| **차트** | 기본 | **Recharts** + **React Flow** |
| **상태관리** | - | **TanStack Query** |
| **Backend** | FastAPI | FastAPI (유지) |
| **DB** | Neo4j | Neo4j (유지) |

---

## 6. 성공 기준

| # | 기준 | 목표값 |
|---|------|--------|
| 1 | Person → News 관계 | > 0 (현재 0) |
| 2 | RiskCategory 노드 | 8개 카테고리 |
| 3 | RiskEvent 노드 | 이슈별 생성 |
| 4 | API-UI 데이터 일치율 | 100% |
| 5 | 드릴다운 depth | 최소 3단계 |
| 6 | 페이지 로드 시간 | < 2초 |

---

## 7. 리스크 및 의존성

### 7.1 리스크

| 리스크 | 영향 | 대응 |
|--------|------|------|
| 기존 데이터 마이그레이션 | 중 | 점진적 마이그레이션 스크립트 |
| UI 전면 개편 공수 | 고 | shadcn/ui 컴포넌트 활용 |
| 테스트 범위 | 중 | 핵심 플로우 우선 테스트 |

### 7.2 의존성

- Neo4j 4.x 이상
- Node.js 18+
- Python 3.10+

---

## 8. 일정 (예상)

| Phase | 작업 | 예상 |
|-------|------|------|
| **Phase 1** | 데이터 구조 완성 | - |
| **Phase 2** | API 재설계 | - |
| **Phase 3** | UI/UX 전면 개편 | - |
| **Phase 4** | 검증 및 테스트 | - |

---

## 9. 다음 단계

1. [ ] 이 Plan 문서 승인
2. [ ] `/pdca design risk-system-v4` 로 상세 설계
3. [ ] Phase 1부터 순차 구현

---

## Appendix: 현재 vs 목표 비교

### A.1 API 응답 비교

**현재 `/api/v2/deals/{id}` 응답:**
```json
{
  "deal": {
    "id": "SK하이닉스",
    "score": 0,
    "directRisk": 0,
    "propagatedRisk": 0
    // 근거 없음, 카테고리 없음
  }
}
```

**목표 `/api/v4/deals/{id}` 응답:**
```json
{
  "deal": {
    "id": "SK하이닉스",
    "score": 40,
    "breakdown": {
      "direct": 35,
      "propagated": 5
    },
    "categories": [
      {
        "code": "LEGAL",
        "name": "법률위험",
        "score": 25,
        "events": [
          {
            "id": "EVT_001",
            "title": "ITC 특허소송",
            "score": 25,
            "newsCount": 3,
            "disclosureCount": 1
          }
        ]
      },
      {
        "code": "GOVERNANCE",
        "name": "지배구조",
        "score": 15,
        "persons": [
          {
            "id": "PER_001",
            "name": "홍길동",
            "position": "대표이사",
            "riskScore": 15,
            "relatedNewsCount": 2
          }
        ]
      }
    ],
    "evidence": {
      "totalNews": 5,
      "totalDisclosures": 1,
      "topFactors": ["ITC 특허소송", "임원 관련 이슈"]
    }
  }
}
```

### A.2 Neo4j 스키마 비교

**현재:**
```
(Company)-[:EXECUTIVE_OF]-(Person)  ✅
(Company)-[:SHAREHOLDER_OF]-(Person) ✅
(Company)-[:MENTIONS]-(News)        ✅
(Company)-[:MENTIONS]-(Disclosure)  ✅
(Person)-[:???]-(News)              ❌ 없음
(RiskCategory)                      ❌ 없음
(RiskEvent)                         ❌ 없음
```

**목표:**
```
(Company)-[:HAS_RISK_CATEGORY]->(RiskCategory)
(RiskCategory)-[:HAS_EVENT]->(RiskEvent)
(RiskEvent)-[:EVIDENCE]->(News|Disclosure)
(Person)-[:INVOLVED_IN]->(RiskEvent)
(Person)-[:MENTIONED_IN]->(News)
```
