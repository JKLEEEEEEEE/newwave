# Risk Monitoring System - 개선 계획서

> **기능명**: risk-improvements
> **버전**: v2.2
> **작성일**: 2026-02-05
> **기반**: risk v2.1 완료 보고서 섹션 5 (개선 필요 영역)

---

## 1. 개요

### 1.1 목적

risk v2.1 기능 완료 후 식별된 개선 필요 영역 및 향후 적용 사항을 체계적으로 정리하고, 우선순위에 따라 단계별 구현 계획을 수립합니다.

### 1.2 현재 상태

| 항목 | 상태 | 비고 |
|------|------|------|
| 설계-구현 일치율 | 100% | 완료 |
| 런타임 안정성 | ✅ | 버그 수정 완료 |
| 데이터 소스 | Mock 데이터 | 실제 연동 필요 |
| AI 기능 | 템플릿만 | OpenAI 연동 필요 |
| 실시간 기능 | 설계만 | WebSocket 구현 필요 |

---

## 2. 개선 필요 영역 (Areas for Improvement)

### 2.1 데이터 연동 (우선순위: 높음)

#### P0: Neo4j 실제 데이터 연동
- **현재**: Mock 데이터로 운영
- **목표**: Neo4j에 실제 기업 데이터 로드
- **작업 항목**:
  - [ ] `.env.local`에 NEO4J_URI, NEO4J_USERNAME, NEO4J_PASSWORD 설정
  - [ ] DART 전자공시 데이터 → Neo4j 로드 스크립트
  - [ ] 뉴스 크롤링 데이터 → Neo4j 로드 스크립트
  - [ ] 실제 Cypher 쿼리 결과 포맷팅
  - [ ] Mock 데이터 fallback 로직 유지

#### P0: OpenAI API 연동
- **현재**: ai_service.py에 프롬프트 템플릿만 존재
- **목표**: 실제 GPT-4 호출로 AI 기능 활성화
- **작업 항목**:
  - [ ] OPENAI_API_KEY 환경 변수 설정
  - [ ] ChatCompletion 클라이언트 초기화
  - [ ] 6대 AI 기능 실제 호출 구현
  - [ ] 토큰 사용량 모니터링
  - [ ] Rate limiting 처리

### 2.2 실시간 기능 (우선순위: 높음)

#### P1: WebSocket 신호 발행 메커니즘
- **현재**: 서버 → 클라이언트 푸시 로직 미구현
- **목표**: 실시간 신호 감지 및 자동 브로드캐스트
- **작업 항목**:
  - [ ] 데이터 소스 폴링 스케줄러 (뉴스, DART, 금감원)
  - [ ] 신호 감지 로직 (임계치 초과 시 발동)
  - [ ] WebSocket 브로드캐스트 메커니즘
  - [ ] 클라이언트 재연결 로직
  - [ ] 연결 상태 모니터링

### 2.3 비즈니스 로직 (우선순위: 중간)

#### P1: 시뮬레이션 로직 정교화
- **현재**: 카테고리별 고정 증가분 적용
- **목표**: 공급망 관계 기반 동적 계산
- **작업 항목**:
  - [ ] Neo4j에서 영향받는 기업 추출
  - [ ] Cascade 효과 계산 알고리즘
  - [ ] 시나리오별 전이 배수 동적 조정
  - [ ] 결과 캐싱 (동일 시나리오 재실행 최적화)

### 2.4 성능 최적화 (우선순위: 중간)

#### P2: 대용량 포트폴리오 지원
- **현재**: 소규모 포트폴리오 기준 설계
- **목표**: 1,000+ 딜 처리 가능
- **작업 항목**:
  - [ ] 그래프 시각화 가상화 (virtualization)
  - [ ] 딜 목록 페이지네이션
  - [ ] API 응답 캐싱 (Redis)
  - [ ] Neo4j 쿼리 최적화 (인덱스 추가)
  - [ ] Lazy loading 적용

### 2.5 UI/UX (우선순위: 낮음)

#### P2: 모바일 반응형 UI
- **현재**: 데스크톱 기준 설계
- **목표**: 태블릿/모바일 지원
- **작업 항목**:
  - [ ] 반응형 그리드 레이아웃
  - [ ] 그래프 터치 인터랙션
  - [ ] 모바일용 간소화 뷰

---

## 3. 향후 적용 사항 (To Apply Next Time)

### 3.1 에러 핸들링 강화

| 항목 | 설명 | 우선순위 |
|------|------|----------|
| API Retry | 호출 실패 시 재시도 로직 | P1 |
| Neo4j 재연결 | 연결 끊김 감지 및 자동 복구 | P1 |
| 데이터 검증 | 스키마 검사 및 유효성 확인 | P2 |
| 사용자 피드백 | 에러 발생 시 UI 알림 | P2 |

### 3.2 테스트 커버리지

| 테스트 유형 | 대상 | 도구 |
|-------------|------|------|
| Unit | 컴포넌트, 유틸 함수 | Jest, React Testing Library |
| Integration | API + Frontend | Cypress |
| E2E | 시뮬레이션 워크플로우 | Playwright |
| Performance | 대용량 데이터 처리 | k6 |

### 3.3 문서화

| 문서 | 설명 | 형식 |
|------|------|------|
| API 문서 | REST/WebSocket 엔드포인트 | OpenAPI/Swagger |
| 컴포넌트 문서 | React 컴포넌트 사용법 | Storybook |
| 그래프 스키마 | Neo4j 노드/관계 정의 | Markdown |
| 운영 가이드 | 배포/모니터링 절차 | Notion/Confluence |

### 3.4 모니터링 & 로깅

| 영역 | 도구 | 목적 |
|------|------|------|
| Frontend | Sentry | 에러 추적, 성능 모니터링 |
| Backend | Loguru + ELK | 요청 로깅, 검색 |
| Neo4j | Query Log | 슬로우 쿼리 감지 |
| 인프라 | Prometheus + Grafana | 리소스 모니터링 |

### 3.5 보안 강화

| 항목 | 설명 | 우선순위 |
|------|------|----------|
| API 인증 | JWT 토큰 기반 인증 | P0 |
| 권한 관리 | RBAC (Role Based Access Control) | P1 |
| 입력 검증 | XSS, SQL Injection 방지 | P0 |
| 데이터 암호화 | 민감 정보 암호화 저장 | P1 |
| 감사 로그 | 사용자 행위 기록 | P2 |

---

## 4. 단계별 로드맵

### Phase 2: 실제 데이터 연동 (2주)

**목표**: Mock → 실제 데이터 전환

| 주차 | 작업 | 담당 |
|------|------|------|
| 1주차 | Neo4j 데이터 로드, 환경 설정 | Backend |
| 1주차 | OpenAI API 연동, 테스트 | Backend |
| 2주차 | WebSocket 폴링 메커니즘 | Backend |
| 2주차 | Frontend 연동 테스트 | Frontend |

**산출물**:
- Neo4j 데이터 로드 스크립트
- AI 기능 활성화
- 실시간 신호 발행

### Phase 3: 고급 기능 (3주)

**목표**: 분석 기능 고도화

| 주차 | 작업 | 담당 |
|------|------|------|
| 3주차 | 시뮬레이션 로직 정교화 | Backend |
| 4주차 | 머신러닝 기반 리스크 예측 | Data Science |
| 5주차 | 커스텀 시나리오 생성 UI | Frontend |

**산출물**:
- 동적 시뮬레이션 엔진
- ML 예측 모델 (Prophet, LSTM)
- 커스텀 시나리오 UI

### Phase 4: 운영 자동화 (2주)

**목표**: 자동 모니터링 및 알림

| 주차 | 작업 | 담당 |
|------|------|------|
| 6주차 | Airflow 기반 스케줄러 | DevOps |
| 7주차 | Slack/Email 알림 연동 | Backend |
| 7주차 | PDF 보고서 내보내기 | Frontend |

**산출물**:
- 자동 모니터링 에이전트
- 알림 시스템
- 정기 보고서 생성

### Phase 5: 제품화 (1주)

**목표**: 프로덕션 준비

| 주차 | 작업 | 담당 |
|------|------|------|
| 8주차 | 성능 최적화 (캐싱, CDN) | DevOps |
| 8주차 | 보안 강화 (인증, 암호화) | Backend |
| 8주차 | 사용자 피드백 반영 | All |

**산출물**:
- 프로덕션 배포
- 보안 감사 완료
- 사용자 가이드

---

## 5. 성공 기준

### 5.1 Phase 2 완료 기준

| 항목 | 기준 | 측정 방법 |
|------|------|---------|
| Neo4j 연동 | 100개 기업 데이터 로드 | 쿼리 성공률 |
| AI 기능 | 6대 기능 모두 동작 | 기능 테스트 |
| 실시간 신호 | 10초 이내 전달 | 지연 시간 측정 |

### 5.2 Phase 3 완료 기준

| 항목 | 기준 | 측정 방법 |
|------|------|---------|
| 시뮬레이션 정확도 | 실제 사례 대비 80% 이상 | 백테스트 |
| ML 예측 | MAPE 20% 이하 | 검증 데이터셋 |
| 커스텀 시나리오 | 사용자 생성 가능 | 기능 테스트 |

### 5.3 Phase 4-5 완료 기준

| 항목 | 기준 | 측정 방법 |
|------|------|---------|
| 자동화 | 수동 개입 없이 24시간 운영 | 모니터링 |
| 성능 | 1,000 딜 처리 시 < 3초 | 부하 테스트 |
| 보안 | OWASP Top 10 취약점 없음 | 보안 감사 |

---

## 6. 리스크 및 의존성

### 6.1 기술적 리스크

| 리스크 | 영향 | 완화 방안 |
|--------|------|---------|
| Neo4j 성능 저하 | 높음 | 인덱스 최적화, 쿼리 튜닝 |
| OpenAI API 비용 | 중간 | 캐싱, 토큰 최적화 |
| WebSocket 안정성 | 중간 | 재연결 로직, 폴백 |

### 6.2 외부 의존성

| 의존성 | 설명 | 대안 |
|--------|------|------|
| Neo4j Aura | 클라우드 Neo4j | 자체 호스팅 |
| OpenAI API | GPT-4 | Claude API, 로컬 LLM |
| DART API | 전자공시 | 크롤링 |

---

## 7. 참고 자료

- **기반 문서**: `/docs/04-report/risk.report.md` 섹션 5
- **설계 문서**: `/docs/02-design/features/risk-monitoring.design.md`
- **구현 코드**: `/components/risk/`, `/risk_engine/`

---

**작성**: 2026-02-05
**상태**: Plan 완료
**다음 단계**: `/pdca design risk-improvements`
